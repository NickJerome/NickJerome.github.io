<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <title>åŸºäºLOUDS çš„ Succinct Set è¯¦è§£ - WangJerome çš„ blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      margin: 0;
      padding: 2rem 1rem 3rem;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
      line-height: 1.7;
      color: #111827;
    }

    .page {
      max-width: 720px;
      margin: 0 auto;
    }

    h1.site-name {
      margin: 0 0 .25rem;
      font-size: 1.6rem;
      font-weight: 700;
    }

    nav a {
      font-size: .9rem;
      margin-right: 1rem;
      color: #2563eb;
      text-decoration: none;
    }

    nav a:hover {
      text-decoration: underline;
    }

    h1.post-title {
      margin: 1.75rem 0 .5rem;
      font-size: 1.8rem;
      font-weight: 700;
    }

    .post-date {
      margin: 0 0 1rem;
      font-size: .9rem;
      color: #6b7280;
    }

    hr {
      border: none;
      border-top: 1px solid #e5e7eb;
      margin: 1.25rem 0;
    }

    main a {
      color: #2563eb;
      text-decoration: none;
    }

    main img {
      max-width: 100%;
      height: auto;
    }

    main table {
      width: 100%;
      table-layout: auto;
      display: block;
      overflow-x: auto;
    }

    main table th,
    main table td {
      white-space: nowrap;
    }
    
    main a:hover {
      text-decoration: underline;
    }

    pre {
      padding: 0.75rem 1rem;
      overflow-x: auto;
      background: #f5f5f5;
      border-radius: 6px;
      font-size: .9rem;
    }

    code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    footer {
      margin-top: 3rem;
      font-size: .8rem;
      color: #9ca3af;
      text-align: center;
    }
  </style>
  <link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/styles/default.min.css">
  <script src="https://unpkg.com/@highlightjs/cdn-assets@11.11.1/highlight.min.js"></script>
</head>
<body>
  <div class="page">
    <header>
      <h1 class="site-name">WangJerome çš„ blog</h1>
      <nav>
        <a href="/">é¦–é¡µ</a>
        <a href="/categories.html">åˆ†ç±»</a>
        <a href="/about.html">å…³äº</a>
      </nav>
    </header>

    <article>
      <h1 class="post-title">åŸºäºLOUDS çš„ Succinct Set è¯¦è§£</h1>
      <p class="post-date">2025-11-21</p>
      <hr />
      <main>
        <h2>å‰ç¼€æ ‘</h2>
<p>å‰ç¼€æ ‘æ˜¯ä¸€ä¸ªé«˜æ•ˆçš„å­˜å‚¨å­—ç¬¦ä¸²é›†åˆçš„æ•°æ®ç»“æ„ï¼Œé€šè¿‡åŒä¸€ä¸ªå‰ç¼€å…±ç”¨èŠ‚ç‚¹æ¥å‹ç¼©ä¿¡æ¯ï¼Œèƒ½å¤Ÿåœ¨éšæœºçš„å­—ç¬¦ä¸²é›†åˆä¸­æœ‰ç€è¾ƒå¥½çš„å‹ç¼©æ•ˆç‡ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æœ‰ä¸€ä¸ªå­—ç¬¦ä¸²é›†åˆ <code>[abï¼Œ abcï¼Œ abcdï¼Œ axyï¼Œ buv]</code> ï¼Œæ‰¾è¿™ä¸ªé›†åˆæ„å»ºçš„å‰ç¼€æ ‘åº”è¯¥å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚æ©™è‰²çš„è¡¨ç¤ºä¸ºå¶å­èŠ‚ç‚¹ï¼ˆå®šä¹‰ä¸ºå­—ç¬¦ä¸²ç»“æŸï¼‰</p>
<p><img src="/assets/succinct%20set/image.png" alt=""></p>
<p>å¯ä»¥å‘ç°ä¸€æ ·çš„å‰ç¼€ <code>ab</code> å·²ç»è¢«åˆå¹¶ä¸ºä¸‰ä¸ªèŠ‚ç‚¹ï¼Œå¯èƒ½åœ¨ç°åœ¨è¿™é‡Œæ²¡æœ‰ä½“ç°å‡ºæ¥ï¼Œä½†åœ¨éå¸¸å¤§çš„æ•°æ®é›†ä¸‹å‹ç¼©æ•ˆç‡æ˜¯éå¸¸æ˜¾è‘—çš„ã€‚</p>
<h2>å‹ç¼©å‰ç¼€æ ‘</h2>
<p>ä½†æ˜¯ä»ç„¶ä¸å¤Ÿï¼Œä¸‹é¢ä»‹ç»åŸºäº<code>Succinct Data Structure</code> æ„å»ºçš„Succinct Setã€‚</p>
<p>é¦–å…ˆå®šä¹‰ä¸€ä¸ªèŠ‚ç‚¹å¦‚ä½•è½¬åŒ–ä¸ºä¸€ä¸²å­—ç¬¦ï¼Œè®¾èŠ‚ç‚¹æœ‰xä¸ªå­èŠ‚ç‚¹ï¼Œåˆ™è¯¥èŠ‚ç‚¹ç”±xä¸ª0å’Œ1ä¸ª1è¡¨ç¤ºï¼Œæœ€ç»ˆå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="/assets/succinct%20set/image-1763724401114.png" alt=""></p>
<p>å°†æ•´ä¸ªå‰ç¼€æ ‘æŒ‰å±‚åºéå†æ‹å¹³å¾—åˆ° <code>001 001 01 01 01 01 01 1 1 1</code> ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p><img src="/assets/succinct%20set/image-1763724407147.png" alt=""></p>
<p>é‚£æ€ä¹ˆå°†å…¶é‡æ–°æ„å»ºå›ä¸€é¢—å‰ç¼€æ ‘ï¼Ÿ</p>
<p>é¦–å…ˆå»ºä¸€ä¸ªè¡¨æ ¼ï¼Œæ¥çœ‹çœ‹æ•°æ®å’ŒèŠ‚ç‚¹ç¼–å·ä¹‹é—´çš„å…³ç³»ï¼Ÿ</p>
<table>
<thead>
<tr>
<th></th>
<th>0</th>
<th>0</th>
<th>1</th>
<th>0</th>
<th>0</th>
<th>1</th>
<th>0</th>
<th>1</th>
<th>0</th>
<th>1</th>
<th>0</th>
<th>1</th>
<th>0</th>
<th>1</th>
<th>0</th>
<th>1</th>
<th>1</th>
<th>1</th>
<th>1</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä½ç½®</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
<td>6</td>
<td>7</td>
<td>8</td>
<td>9</td>
<td>10</td>
<td>11</td>
<td>12</td>
<td>13</td>
<td>14</td>
<td>15</td>
<td>16</td>
<td>17</td>
<td>18</td>
</tr>
<tr>
<td>ç¼–å·</td>
<td>a</td>
<td>b</td>
<td><strong>0</strong></td>
<td>b</td>
<td>x</td>
<td><strong>1</strong></td>
<td>u</td>
<td><strong>2</strong></td>
<td>c</td>
<td><strong>3</strong></td>
<td>y</td>
<td><strong>4</strong></td>
<td>v</td>
<td><strong>5</strong></td>
<td>d</td>
<td><strong>6</strong></td>
<td><strong>7</strong></td>
<td><strong>8</strong></td>
<td><strong>9</strong></td>
</tr>
</tbody>
</table>
<p>å¯ä»¥å‘ç°ç¬¬ <code>x</code> ä¸ªèŠ‚ç‚¹çš„ç¼–å·å°±æ˜¯ ç¬¬ <code>x</code> ä¸ª1ï¼é‚£ä¹ˆå®šä¹‰ç¬¬ä¸€ä¸ªè¾…åŠ©å‡½æ•° <code>Rank1(r)</code> è¡¨ç¤º <code>[0, r]</code> ä¸­ 1 çš„ä¸ªæ•°ã€‚é‚£ä¹ˆç¬¬ i ä¸ªä½ç½®å¯¹åº”çš„ç¼–å·å°±æ˜¯ <code>Rank(i) - 1</code> ï¼ˆå¿…é¡»ä¸ºèŠ‚ç‚¹)</p>
<p>é‚£æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªèŠ‚ç‚¹ç¼–å·å¦‚ä½•å®šä½å›ä½ç½®å‘¢ï¼Ÿå¯ä»¥å‘ç°å°±æ˜¯1çš„ä½ç½®ï¼é‚£ä¹ˆå®šä¹‰ç¬¬äºŒä¸ªè¾…åŠ©å‡½æ•° <code>Select(i)</code> è¡¨ç¤ºç¬¬ <code>i</code> ä¸ªèŠ‚ç‚¹çš„ä½ç½®ï¼</p>
<p>äºæ˜¯æˆ‘ä»¬å¾—åˆ°äº†ä¸‹é¢çš„æ–°çš„è¡¨æ ¼</p>
<table>
<thead>
<tr>
<th></th>
<th>0</th>
<th>0</th>
<th>1</th>
<th>0</th>
<th>0</th>
<th>1</th>
<th>0</th>
<th>1</th>
<th>0</th>
<th>1</th>
<th>0</th>
<th>1</th>
<th>0</th>
<th>1</th>
<th>0</th>
<th>1</th>
<th>1</th>
<th>1</th>
<th>1</th>
</tr>
</thead>
<tbody>
<tr>
<td>ä½ç½®</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
<td>6</td>
<td>7</td>
<td>8</td>
<td>9</td>
<td>10</td>
<td>11</td>
<td>12</td>
<td>13</td>
<td>14</td>
<td>15</td>
<td>16</td>
<td>17</td>
<td>18</td>
</tr>
<tr>
<td>ç¼–å·</td>
<td>a</td>
<td>b</td>
<td><strong>0</strong></td>
<td>b</td>
<td>x</td>
<td><strong>1</strong></td>
<td>u</td>
<td><strong>2</strong></td>
<td>c</td>
<td><strong>3</strong></td>
<td>y</td>
<td><strong>4</strong></td>
<td>v</td>
<td><strong>5</strong></td>
<td>d</td>
<td><strong>6</strong></td>
<td><strong>7</strong></td>
<td><strong>8</strong></td>
<td><strong>9</strong></td>
</tr>
<tr>
<td>Rank</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>2</td>
<td>2</td>
<td>3</td>
<td>3</td>
<td>4</td>
<td>4</td>
<td>5</td>
<td>5</td>
<td>6</td>
<td>6</td>
<td>7</td>
<td>8</td>
<td>9</td>
<td>10</td>
</tr>
<tr>
<td>Select</td>
<td>2</td>
<td>5</td>
<td>7</td>
<td>9</td>
<td>11</td>
<td>13</td>
<td>15</td>
<td>16</td>
<td>17</td>
<td>18</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>ä¸çŸ¥é“ç¼ºå°‘ä»€ä¹ˆäº†ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±æ¥æ‰§è¡Œå‰ç¼€æ ‘è¯¥æœ‰çš„åŠŸèƒ½æ¥çœ‹çœ‹è¿˜å·®ä»€ä¹ˆï¼</p>
<p>å›åˆ°æœ€å¼€å§‹çš„å‹ç¼©å‰ç¼€æ ‘çš„å›¾ã€‚æ¨¡æ‹Ÿæœç´¢ä¸€ä¸‹ <code>axy</code></p>
<ol>
<li>æ‰¾åˆ° <code>a</code> çš„è¾¹ï¼Œæ˜¯ä½ç½® <code>0</code> ï¼Œç„¶åè¦è·³åˆ°å­èŠ‚ç‚¹ <code>1</code></li>
</ol>
<p><img src="/assets/succinct%20set/image-1763724416412.png" alt=""></p>
<p>é—®é¢˜æ¥äº†ï¼æˆ‘ä»¬æ€ä¹ˆçŸ¥é“è¦è·³åˆ°å“ªä¸ªèŠ‚ç‚¹ï¼Ÿ</p>
<p>è€ƒè™‘åˆ°æ˜¯å±‚åºéå†å¾—åˆ°çš„æ•°æ®ï¼Œæ¯ä¸€ä¸ª <code>0</code> å…¶å®éƒ½æ˜¯å¯¹åº”ç€ä¸€ä¸ªèŠ‚ç‚¹å’Œä¸€æ¡è¾¹ï¼Œåˆç”±äºæ ¹èŠ‚ç‚¹æ²¡æœ‰è¾¹ï¼Œåˆ™ç¬¬ <code>x</code> ä¸ª <code>0</code> å¯¹åº”çš„å°±æ˜¯ç¬¬ <code>x + 1</code> ä¸ªèŠ‚ç‚¹ï¼é‚£å°±æ¥ç€æ“ä½œ</p>
<ol start="2">
<li>æ‰¾åˆ° <code>x</code> çš„è¾¹ï¼Œæ˜¯ä½ç½® <code>3</code> ï¼Œç„¶åè¦è·³åˆ°å­èŠ‚ç‚¹ <code>4</code></li>
</ol>
<p><img src="/assets/succinct%20set/image-1763724418033.png" alt=""></p>
<ol start="3">
<li>æ‰¾åˆ° <code>y</code> çš„è¾¹ï¼Œæ˜¯ä½ç½® <code>3</code> ï¼Œç„¶åè¦è·³åˆ°å­èŠ‚ç‚¹ <code>4</code></li>
</ol>
<p><img src="/assets/succinct%20set/image-1763724419131.png" alt=""></p>
<p>ç„¶åå‘ç°æ˜¯å¶å­èŠ‚ç‚¹ï¼è¿™å¤ªå·§äº†ï¼å‘ç°å‹ç¼©æ•°æ®ä¸­å¹¶ä¸èƒ½å¾—çŸ¥è¿™ä¸ªç‚¹æ˜¯ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œéœ€è¦é¢å¤–çš„æ ‡è®°ï¼Œäºæ˜¯éœ€è¦ä¸€ä¸ª <code>leaves</code> æ•°ç»„æ¥æ ‡è®°å¶å­èŠ‚ç‚¹ï¼Œ<code>leaves[i]</code> ä¸º <code>1</code> è¡¨ç¤ºèŠ‚ç‚¹ <code>i</code> æ˜¯å¶å­èŠ‚ç‚¹ï¼</p>
<h2>æ€»ç»“</h2>
<h3>è¾…åŠ©å‡½æ•°ï¼šRank å’Œ Select</h3>
<table>
<thead>
<tr>
<th style="text-align:left">å‡½æ•°</th>
<th style="text-align:left">ä½œç”¨</th>
<th style="text-align:left">ä¸¾ä¸ªæ —å­ ğŸŒ°</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><code>Rank1(r)</code></td>
<td style="text-align:left">æ•°ä¸€æ•°å‰ <code>r</code> ä¸ªä½ç½®æœ‰å‡ ä¸ª <code>1</code></td>
<td style="text-align:left">å‰5ä¸ªä½ç½®æœ‰2ä¸ª<code>1</code> â†’ <code>Rank1(5)=2</code></td>
</tr>
<tr>
<td style="text-align:left"><code>Select(i)</code></td>
<td style="text-align:left">æ‰¾ç¬¬ <code>i</code> ä¸ª <code>1</code> è—åœ¨å“ªå„¿</td>
<td style="text-align:left">ç¬¬1ä¸ª<code>1</code>åœ¨ä½ç½®5 â†’ <code>Select(1)=5</code></td>
</tr>
</tbody>
</table>
<h3>ä¸ºä»€ä¹ˆéœ€è¦â€œç»ˆç‚¹æ ‡è®°â€ï¼Ÿ</h3>
<ul>
<li><strong>çœŸç›¸</strong>ï¼šå‹ç¼©åçš„äºŒè¿›åˆ¶ä¸²çœ‹ä¸å‡ºå“ªé‡Œæ˜¯å•è¯ç»“å°¾ï¼Œå°±åƒä¸€æœ¬ä¹¦æ²¡äº†å¥å·ï¼</li>
<li><strong>è§£å†³æ–¹æ¡ˆ</strong>ï¼šç”¨ <code>leaves</code> æ•°ç»„å½“â€œå°çº¢æ——â€ ğŸš©ï¼Œæ ‡è®°å“ªäº›èŠ‚ç‚¹æ˜¯ç»ˆç‚¹ã€‚</li>
</ul>
<h3>å¯¹æ¯”ï¼šä¼ ç»ŸTrie Vs SuccinctSet Vs BinarySearch</h3>
<p>200kweb2.txtï¼ˆå¿½ç•¥æ„å»ºæ—¶é—´ï¼‰ï¼ŒæŸ¥è¯¢é€Ÿåº¦æœ€æ…¢å¯èƒ½æ˜¯æˆ‘å†™æ‹‰äº†</p>
<table>
<thead>
<tr>
<th style="text-align:left">ç»“æ„</th>
<th style="text-align:left">å†…å­˜å ç”¨(KB)</th>
<th style="text-align:left">å‹ç¼©ç‡</th>
<th style="text-align:left">æŸ¥è¯¢é€Ÿåº¦(OPS)</th>
<th style="text-align:left">é€‚åˆåœºæ™¯</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">ä¼ ç»ŸTrie</td>
<td style="text-align:left">69367.78</td>
<td style="text-align:left">2850%</td>
<td style="text-align:left">1560000</td>
<td style="text-align:left">åŠ¨æ€çš„å°å‹æ•°æ®é‡</td>
</tr>
<tr>
<td style="text-align:left">Succinct Set</td>
<td style="text-align:left">1604.5</td>
<td style="text-align:left">65%</td>
<td style="text-align:left">740000</td>
<td style="text-align:left">é™æ€çš„æµ·é‡å­—ç¬¦ä¸²é›†åˆ</td>
</tr>
<tr>
<td style="text-align:left">BinarySearch</td>
<td style="text-align:left">10836.37</td>
<td style="text-align:left">445%</td>
<td style="text-align:left">1680000</td>
<td style="text-align:left">ç®€å•çš„ä½¿ç”¨åœºæ™¯</td>
</tr>
</tbody>
</table>
<p>ä¸‹é¢æ˜¯ç®€å•çš„C++å®ç°</p>
<pre><code class="language-cpp">#include &lt;cstddef&gt;
#include &lt;cstdint&gt;
#include &lt;vector&gt;
#include &lt;string&gt;
#include &lt;queue&gt;
#include &lt;algorithm&gt;

class BitMap {
    static constexpr size_t GAP = 64;
public:
    BitMap(size_t n = 0) : bits_((n + 63) / 64) {}
    void Set(size_t p, bool v = true) {
        if (bits_.size() &lt;= (p / 64)) {
            bits_.resize(2 * (p / 64) + 1);
        }
        uint64_t mask = 1ULL &lt;&lt; (p % 64);
        bits_[p / 64] = v ? (bits_[p / 64] | mask) : (bits_[p / 64] &amp; ~mask);
    }
    bool Get(size_t p) {
        if (bits_.size() &lt;= (p / 64)) {
            bits_.resize(2 * (p / 64) + 1);
        }
        return (bits_[p / 64] &amp; (1ULL &lt;&lt; (p % 64))) != 0;
    }
    size_t Size() const {
        return bits_.size() * 64;
    }
    size_t Rank(size_t r) {
        size_t block = r / 64, offset = r % 64;
        return ranks[block] + __builtin_popcountll(bits_[block] &amp; ((1ULL &lt;&lt; offset) - 1));
    }
    size_t Select(size_t k) {
        if (k == 0 || k &gt; ranks.back()) return -1;

        // hit the precache;
        if (k % GAP == 0) {
            return selects[k / GAP - 1];
        }
        const size_t m = (k - 1) / GAP;
        size_t start_block = 0;
        if (m &gt; 0) {
            start_block = selects[m - 1] / 64;
            k -= ranks[start_block];
        }

        for (size_t idx = start_block; idx &lt; bits_.size(); ++idx) {
            uint64_t block = bits_[idx];
            size_t cnt = __builtin_popcountll(block);
            if (cnt &lt; k) {
                k -= cnt;
                continue;
            }
            for (size_t i = 0; i &lt; 64; ++i) {
                if (block &amp; (1ULL &lt;&lt; i)) {
                    if (--k == 0) return idx * 64 + i;
                }
            }
        }
        return -1;
    }
    
    void Precompute() {
        ranks.assign(1, 0);
        size_t cnt = 0;
        for (size_t i = 0; i &lt; bits_.size(); ++i) {
            uint64_t block = bits_[i];
            ranks.push_back(ranks.back() + __builtin_popcountll(block));
            for (size_t j = 0; j &lt; 64; j++) {
                if (block &gt;&gt; j &amp; 1) {
                    cnt ++;
                    if (cnt % GAP == 0) {
                        selects.push_back(i * 64 + j);
                    }
                }
            }
        }
    }
private:
    std::vector&lt;uint64_t&gt; bits_;
    std::vector&lt;size_t&gt; ranks, selects;
};

class SuccinctSet {
public:
    explicit SuccinctSet(std::vector&lt;std::string&gt; keys) {
        std::sort(keys.begin(), keys.end());

        std::queue&lt;std::tuple&lt;size_t, size_t, size_t&gt;&gt; q;
        q.emplace(0, keys.size(), 0);
        size_t nodeCount = 0;
        for (size_t nodeId = 0; !q.empty(); nodeId ++) {
            auto [L, R, index] = q.front();
            q.pop();
            
            while (L &lt; R) {

                while (L &lt; R &amp;&amp; keys[L].size() &lt;= index) {
                    L++;
                    is_leaf_.Set(nodeId, true);
                }
                if (L == R) {
                    break;
                }

                int nL = L + 1;
                while (nL &lt; R &amp;&amp; index &lt; keys[nL].size() &amp;&amp; keys[nL][index] == keys[L][index]) {
                    nL++;
                }

                labels_.push_back(keys[L][index]);
                q.emplace(L, nL, index + 1);
                label_bitmap_.Set(nodeCount ++, false);
                L = nL;
            }
            label_bitmap_.Set(nodeCount ++, true);
        }
        label_bitmap_.Precompute();
    }

    bool Contains(const std::string &amp;key) {
        size_t nodeId = 0, bitmapIndex = 0;
        for (char c : key) {
            while (bitmapIndex &lt; label_bitmap_.Size()) {
                if (label_bitmap_.Get(bitmapIndex)) {
                    return false;
                }

                if (labels_[bitmapIndex - nodeId] == c) {
                    break;
                }

                bitmapIndex ++;
            }
            nodeId = bitmapIndex + 1 - label_bitmap_.Rank(bitmapIndex + 1);
            bitmapIndex = label_bitmap_.Select(nodeId) + 1;
        }
        return is_leaf_.Get(nodeId);
    }
private:
    std::vector&lt;char&gt; labels_;
    BitMap label_bitmap_;
    BitMap is_leaf_;
};
</code></pre>

      </main>
    </article>

    <footer>
      Â© 2025 WangJerome çš„ blog. ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚
    </footer>
  </div>
  <script>hljs.highlightAll();</script>
</body>
</html>
